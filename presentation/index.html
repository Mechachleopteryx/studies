<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Django</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/moon.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
        <link href='http://fonts.googleapis.com/css?family=Oswald&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Django</h1>
					<h3>Framework webowy dla perfekcjonistów</h3>
				</section>

				<section>
                    <section>
                        <h2>Pierwsze kroki z Django</h2>

                        <aside class="notes">
                            Oh hey, these are some notes. They'll be hidden in your presentation, but you can see them if you open the speaker notes window (hit 's' on your keyboard).
                        </aside>
                    </section>
                    <section>
						<h2>O mnie</h2>
                        <p>Tomasz Woźniak / tomaszwozniak@stxnext.pl</p>
						<p>Senior Python Developer, Technical Team Leader.</p>
                        <p>Magister informatyki na UEP.</p>
                        <p>Ponad 5 letnie doświadczenie z językiem Python.</p>
                        <p><a href="http://www.django.studies.twozniak.pl">http://www.django.studies.twozniak.pl</a></p>

					</section>
                    <section>
						<h2>Agenda</h2>
                        <li>Wprowadzenie</li>
                        <li>Modele i ORM</li>
                        <li>Widoki</li>
                        <li>Szablony</li>
                        <li>Piszemy prostego bloga</li>
					</section>
                    <section>
						<h2>Framework</h2>
                        <li>platforma programistyczna,</li>
                        <li>szkielet do budowy aplikacji,</li>
                        <li>definiuje jej strukturę oraz mechanizm działania,</li>
                        <li>dostarcza gotowe biblioteki,</li>
                        <li>automatyzuje czynności,</li>
                        <li>wymusza konwencje pracy.</li>
					</section>
                    <section>
						<h2>Czym jest django?</h2>
                        <li>opensourcowy, wysokopoziomowy framework napisany w Pythonie,</li>
                        <li>MTV - Model-Template-View</li>
                        <li>przypomina wzorzec projektowy MVC <br/>(Model-View-Controller),</li>
                        <li>rozwijany przez Django Software Foundation.</li>
					</section>
                    <section>
						<h2>Konkretnie</h2>
                        <li>bogata dokumentacja,</li>
                        <li>bardzo szeroka oferta gotowych bibliotek,</li>
                        <li>własny ORM (Object Relational Mapping) + system migracji,</li>
                        <li>automatyczny interfejs administratora,</li>
                        <li>asynchroniczne lub harmonogramowe zadania w tle (django-celery),</li>
                        <li>system użytkowników (autoryzacja, rejestracja, zarządzanie profilem),</li>
                        <li>system migracji bazy danych,</li>
                        <li>łatwość budowania wielojęzycznych aplikacji,
                        <li>system formularzy,</li>
                        <li> i wiele innych.</li>

					</section>
                    <section>
						<h2>Struktura w teorii</h2>
                        <img src="http://media.twozniak.pl/structure.png">
                        Autor: <a href="http://www.flickr.com/photos/jcroft">Jeff Croft</a>
					</section>
                    <section>
						<h2>Struktura w projekcie</h2>
                        <pre><code data-trim contenteditable>
blog
   blog
       __init__.py
       settings.py
       urls.py
       wsgi.py
   post
       __init__.py
       admin.py
       forms.py
       models.py
       tests.py
       urls.py
       views.py
					</code></pre>
					</section>
                    <section>
						<h2>Czego potrzebujemy?</h2>
                        <li>Komputer z systemem Linux, OSx lub Windows</li>
                        <li>Edytor tekstu (np: PyCharm lub Sublime Text),</li>
                        <li>Python 2.7.x,</li>
                        <li>Django 1.8.2,</li>
                        <li>Virtualenv.</li>
					</section>
                    <section>
						<h2>Czego użyjemy do nauki?</h2>
                        <li><a href="https://c9.io">https://c9.io</a></li>
					</section>
                    <section>
						<h2>Tworzymy projekt</h2>
                        <pre><code data-trim contenteditable>
virtualenv env
source env/bin/activate
pip install django
django-admin.py startproject blog
					</code></pre>
					</section>
                    <section>
						<h2>Projekt vs Aplikacja</h2>
                        <p><i>"Jaka jest różnica pomiędzy projektem a aplikacją? Aplikacja coś robi — jest nią np. system blogowy, rejestr danych publicznych lub prosta ankieta. Projekt jest kolekcją konfiguracji i aplikacji dla określonej strony www. Projekt może zawierać wiele aplikacji. Dana aplikacja może być w wielu projektach."</i> - django.pl</p>
                    </section>
                    <section>
						<h2>manage.py</h2>
                        <p>Uruchamiamy serwer deweloperski:</p>
                        <pre><code data-trim contenteditable>
# Na standardowym porcie 8000
python manage.py runserver
# Na porcie 8080
python manage.py runserver 0.0.0.0:8080
# Wyświetlenie wszystkich komend
python manage.py --help
# Wyświetlenie pomocy dla konkretnej komendy
python manage.py sql --help

					    </code></pre>
                        <p>Co będzie potrzebne na początek?</p>
                        <pre><code data-trim contenteditable>
# Tworzenie aplikacji
python manage.py startapp nazwa_aplikacji
# Konsola pythona z dostępem do django i całego projektu
python manage.py shell
# Tworzenie bazy danych na podstawie modeli
python manage.py syncdb
# Uruchamianie testów jednostkowych
python manage.py test
					    </code></pre>
					</section>
                    <section>
						<h2>settings.py</h2>
                        <pre><code data-trim contenteditable>
# Tryb debugowania, domyślny tryb pracy developera, powinniśmy pamiętać
# o wyłączeniu go przed wystawieniem kodu na produkcje.
DEBUG = True
# Działa tylko w przypadku trybu produkcyjnego (DEBUG = False)
# Dostępne domeny na których ma działać nasza aplikacja.
ALLOWED_HOSTS = []
# Krotka z nazwą dostępnych aplikacji.
INSTALLED_APPS = (
    ...
)
# Ustawienia bazy danych.
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'data.db'),
    }
}
					</code></pre>
					</section>
                    <section>
						<h2>requirements.pip</h2>
                        <p>Wymagane pakiety przez naszą aplikacje:</p>
                        <pre><code data-trim contenteditable>
django==1.8.2
pytz
					</code></pre>
                     <p>Instalacja wszystkich jednym poleceniem:</p>
                     <pre><code data-trim contenteditable>
pip install -r requirements.pip
					</code></pre>
					</section>
                    <section>
						<h2>Bazy danych</h2>
                        <li>PostgreSQL, MySQL, SQLite, Oracle</li>
                        <li>Możliwość użycia kilku baz danych w jednym projekcie</li>
                        <li>dostępne dodatki takie jak ORM dla baz NoSQL (MongoDB, DynamoDB)</li>
					</section>
                    <section>
						<h2>Nasza Baza danych</h2>
                        <li>na potrzebę zajęć został wybrany sqlite3</li>
                        <li>baza będzie przechowywana jako pojedynczy plik w projekcie, bez potrzeby instalacji dodatkowych usług w systemie</li>
                        <li>sqliteman - prosta przeglądarka baz danych sqlite</li>
                        <li>dzięki ORM budowa aplikacji będzie wyglądała identycznie jak na postgresql lub mysql</li>
                        <li>zaleca się pracowanie na takiej samej bazie danych jaka ma być użyta na produkcji</li>
					</section>
                    <section>
						<h2>Tworzymy aplikacje</h2>
                        <pre><code data-trim contenteditable>
python manage.py startapp post
					</code></pre>
                    <p>Włączamy ją w settings.py:</p>
                    <pre><code data-trim contenteditable>
INSTALLED_APPS = (
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'post'
)
					</code></pre>
					</section>
                    <section>
						<h2>Tworzymy bazę oraz superusera</h2>
                        <pre><code data-trim contenteditable>
python manage.py migrate
python manage.py createsuperuser
					</code></pre>
					</section>
				</section>

				<!-- Example of nested vertical slides -->
				<section>
					<section>
						<h2>Modele i ORM</h2>
					</section>
					<section>
						<h2>Czym jest model?</h2>
                        <li>Przedstawia logikę biznesową aplikacji</li>
						<li>klasa Pythona dziedzicząca po klasie Model z Django</li>
                        <li>tworzy/mapuje tabelę w bazie</li>
                        <li>pola klasy odzwierciedlają kolumny w bazie danych</li>
                                                <pre><code data-trim contenteditable>
from django.db import models

class Post(models.Model):
    title = models.CharField(max_length=64)
                        </code></pre>
					</section>
					<section>
						<h2>Tworzymy model</h2>
<a href="https://raw.githubusercontent.com/tomaszwozniak/studies/master/post/models.py">https://github.com/tomaszwozniak/studies/blob/master/post/models.py</a>
                        <p>Unikajmy:</p>
                        <li>zarezerwowanych nazw dla Pythona np: id, type, pass, datetime, sum, list, dict</li>
                        <li>nazwy z podwójnym underscorem: foo__bar</li>
					</section>
                    <section>
						<h2>Pola i ich argumenty</h2>
                        <pre><code data-trim contenteditable>
# w polach typu CharField musimy podać maksymalną dlugość tekstu.
title = models.CharField(max_length=64)
# auto_now_add oznacza, że django automatycznie ustawi datę
# pierwszego utworzenia obiektu.
created = models.DateTimeField(auto_now_add=True)
# w tym przypadku django zawsze zaaktualizuje datę
# po modyfikacji obiektu.
modified = models.DateTimeField(auto_now=True)
# verbose_name - nazwa pola reprezentowana np. panelu admina.
# null=True - zezwolenie na puste wartości.
# blank=True - zezwolenie na puste wartości w formularzach.
tags = models.CharField(
    verbose_name=u'Related tags', max_length=200, null=True, blank=True)
                       </code></pre>
                       <pre><code data-trim contenteditable>
# Klucz obcy podany w formacie 'app.Model'
models.ForeignKey('post.Post')
# Tekst pomocy (wyświetlany jako podpowiedź np. panelu admina)
models.TextField(help_text=u'Please be nice')
                        </code></pre>
                        <a href="https://docs.djangoproject.com/en/dev/ref/models/fields/">https://docs.djangoproject.com/en/dev/ref/models/fields/</a>
					</section>
					<section>
						<h2>Migracje</h2>
						<p>Migrowanie na podstawie modeli:</p>
                    <pre><code data-trim contenteditable>
python manage.py makemigrations post
Migrations for 'post':
  0001_initial.py:
    - Create model Comment
    - Create model Post
    - Add field post to comment
					</code></pre>
                    <p>Zostanie utworzony plik migracji w katalogu migrations</p>
                    <p>Aby zatwierdzić (uruchomić) migracje na bazie:</p>
                    <pre><code data-trim contenteditable>
python manage.py migrate
					</code></pre>
					</section>
                    <section>
						<h2>Panel administratora</h2>
						<p>Uruchamiamy serwer:</p>
                    <pre><code data-trim contenteditable>
python manage.py runserver 0.0.0.0:8080
					</code></pre>
                        <p>Przechodzimy do adresu który pojawi się w podpowiedzi c9
                        <p class="fragment">Gdzie moje modele? </p>
                        <p class="fragment">Musimy je najpierw zarejestrować w pliku admin.py</p>
					</section>
                    <section>
						<h2>Rejestrujemy modele</h2>
						<p>W katalogu aplikacji (post), w pliku admin.py:</p>
                        <pre><code data-trim contenteditable>
from django.contrib import admin

from post.models import Post, Comment

admin.site.register(Post)
admin.site.register(Comment)
                        </code></pre>
					</section>
                    <section>
						<h2>Metody unicode</h2>
						<p>Poprawiamy format prezentacji obiektu</p>
                        <pre><code data-trim contenteditable>
def __unicode__(self):  # __str__ on Python 3
    return u'{}...'.format(self.title[:10])
                        </code></pre>
                        <pre><code data-trim contenteditable>
def __unicode__(self):  # __str__ on Python 3
    return u'{} by {}'.format(self.value[:10], self.full_name)
                        </code></pre>
					</section>
                    <section>
						<h2>Zadanie</h2>
<ol>
<li>Stwórz nową aplikacje pt. subscription.</li>
<li>Zarejestruj ja w panelu administratora i w settings.py.</li>
<li>Stwórz model pt 'Mailing' z następującymi polami:</li>
<p>- email (email field, wymagane),</p>
<p>- expiry_date (datetime field, wymagane),</p>
<p>- source (url field, niewymagane),</p>
<p>- accepted (bool field),</p>
<li>Napisz odpowiednie metody __unicode__:</li>
<li>Zarejestruj model w panelu administratora (plik admin.py).</li>
<li>Dodaj przykładowe dane.</li>
</ol>
<a href="https://docs.djangoproject.com/en/dev/ref/models/fields/#field-types">https://docs.djangoproject.com/en/dev/ref/models/fields/#field-types</a>
					</section>
                    <section>
						<h2>ORM</h2>
						<p>Mapowanie obiektowo-relacyjne (ang. Object-Relational Mapping ORM)</p>
                        <p>Zalety Django ORM:</p>
                        <li>prostota, czytelność,</li>
                        <li>mniejsza szansa na pomyłkę,</li>
                        <li>duże możliwości,</li>
                        <li>łatwe poruszanie się pomiędzy relacjami,</li>
                        <li>znacznie przyspiesza pracę nad projektem,</li>
                        <li>w każdej chwili można zmienić bazę danych bez potrzeby zmian w kodzie.</li>
					</section>
                    <section>
						<h2>ORM</h2>
						<p>Mapowanie obiektowo-relacyjne (ang. Object-Relational Mapping ORM)</p>
                        <p>Wady Django ORM:</p>
                        <li>dodatkowa warstwa komunikacji (subtelnie wolniejszy),</li>
                        <li>mało użyteczne dla skomplikowanych analitycznych zapytań,</li>
                        <li>programista zapomina / nie nauczy się SQL (wada?).</li>
					</section>
                    <section>
						<h2>SQL i ORM prosty select</h2>
                        <pre><code data-trim contenteditable>
SELECT "post_post"."id", "post_post"."title", "post_post"."content",
"post_post"."created", "post_post"."modified", "post_post"."tags"
FROM "post_post" INNER JOIN "post_comment" ON (
"post_post"."id" = "post_comment"."post_id" ) WHERE
"post_comment"."id" = 1  ORDER BY "post_post"."modified" DESC
                        </code></pre>
                        <p>==</p>
                        <pre><code data-trim contenteditable>
                            Post.objects.filter(comment__id=1)
                        </code></pre>
					</section>
                    <section>
						<h2>Django shell</h2>
                        <p>Przydatne narzędzie do debugowania, posłuży nam do ćwiczeń pracy z ORM.</p>
                        <pre><code data-trim contenteditable>
python manage.py shell
Python 2.7.5+ (default, Feb 27 2014, 19:37:08)
[GCC 4.8.1] on linux2
Type "help", "copyright", "credits" or "license" for more information.
(InteractiveConsole)
# importujemy modele (klasy)
>>> from post.models import Post, Comment
# Pobieramy wszystkie obiekty z bazy
>>> print Post.objects.all()
[< Post: abc>, < Post: 8768>]
# Tworzymy obiekt w bazie i przypisujemy go do zmiennej post
>>> post = Post.objects.create(title='Post from djshell', content='abc')
# Wyświetlamy obiekt post (Zwraca nam to co ustawiliśmy
# w metodzie __unicode__)
>>> print post
Post from djshell
                        </code></pre>
					</section>
                    <section>
						<h2>Obiekt != Pozycja w bazie</h2>
                        <p>w przypadku tworzenia obiektu w standardowy sposób za pomocą wywołania nazwy modelu (klasy), np: Post() obiekt nie pojawi się w bazie do momentu wywołania na nim metody save()</p>
                        <pre><code data-trim contenteditable>
# Tworzymy obiekt po "Pythonowemu"
>>> post = Post()
>>> post.title = 'Tytuł2'
>>> post.content = 'Content2'
# Próbuje wyświetlić jego id
>>> print post.id
None
>>> post.save()
>>> print post.id
5
                        </code></pre>
					</section>
                    <section>
						<h2>Dodawanie obiektu z relacja</h2>
                        <pre><code data-trim contenteditable>
# Tworzymy obiekt przez ORM który automatycznie zapisze go w bazie
>>> post = Post.objects.create(
    title='Pierwszy wpis', content='Lorem ipsum...')
>>> print post
Pierwszy wpis
# Próbujemy tego samego z komentarzem, zapominamy przy tym
# o wymaganym kluczu obcym "Post"
>>> comment = Comment.objects.create(
    full_name='Jan Nowak', value='Super post')
IntegrityError: NOT NULL constraint failed: post_comment.post_id
# Poprawiamy swój błąd
>>> comment = Comment.objects.create(
    full_name='Jan Nowak', value='Super post', post=post)
>>> print comment
Super post by Jan Nowak
                        </code></pre>
					</section>

                    <section>
                            <h2>Dodawanie obiektu z relacja cd</h2>
                            <pre><code data-trim contenteditable>
# ciąg dalszy
>>> print comment
Super post by Jan Nowak
# Wyświetlamy wartość 'value' z obiektu comment
>>> print comment.value
'Super post'
# Odwołujemy się do obiektu 'post' przez obiekt 'comment' po kropce:
>>> print comment.post
Pierwszy wpis
# Tym samym sposobem mamy dostęp do pozostałych danych z modelu 'post':
>>> print comment.post.title
'Test'
# Wiemy już jak przejść przez klucz obcy z comment do post, poniżej
# przykład jak wyświetlić wszystkie komentarze dla danego postu:
>>> print post.comment_set.all()
[< Comment: Super post by Jan Nowak>]
                            </code></pre>
                      </section>
                      <section>
                            <h2>Edycja obiektów</h2>
                            <pre><code data-trim contenteditable>
>>> post = Post.objects.get(pk=1)
>>> print post
Apple patc...
>>> print post.views
757
>>> post.views = 1000
>>> post.save()
>>> print post.views
1000
                            </code></pre>
                      </section>
                      <section>
                            <h2>Usuwanie obiektów</h2>
                            <pre><code data-trim contenteditable>
>>> post = Post.objects.get(pk=1)
>>> post.delete()
>>> post = Post.objects.get(pk=1)
Traceback (most recent call last):
...
DoesNotExist: Post matching query does not exist.

                            </code></pre>
                      </section>
                      <section>
                            <h2>Baza danych do ćwiczeń</h2>
                            <p>Pobieram bazę do ćwiczeń (View Raw)</p>
                            <a href="https://github.com/tomaszwozniak/studies/blob/master/data.db">https://github.com/tomaszwozniak/studies/blob/master/data.db</a>
                            <p>Zmieniamy settings.py ustawienia bazy danych:</p>
                            <pre><code data-trim contenteditable>
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'data.db'),
    }
}
                            </code></pre>
                          <p>Wyłączamy aplikacje subscribe</p>
                      </section>
                      <section>
                            <h2>Pobieranie zbiorów z bazy - Queryset</h2>
                            <pre><code data-trim contenteditable>
# Importy
>>> from post.models import Post, Comment
# Pobranie wszystkich obiektów z bazy danych:
>>> print Post.objects.all()
< Post: Breaking N...>, < Post: Breaking N...>, < Post: Madrid's p...>
# Pobranie wszystkich obiektów z bazny danych oraz
# posortowanie ich po tytule rosnąco:
>>> print Post.objects.all().order_by('title')
< Post: Apple Expa...>, < Post: Apple patc...>, < Post: Avira Lice...>
# Pobranie wszystkich obiektów z bazny danych oraz
# posortowanie ich po tytule malejąco:
>>> print Post.objects.all().order_by('-title')
< Post: TrackingPo...>, < Post: The UPC ba...>, < Post: The Top Fi...>,
# Sortowanie po title, jeżeli znajdzie dwa takie
# same tytuły, następnym kryterium będzie data utworzenia:
>>> print Post.objects.all().order_by('title', 'created')
< Post: Apple Expa...>, < Post: Apple patc...>, < Post: Avira Lice...>
                            </code></pre>
                        <a href="https://docs.djangoproject.com/en/dev/ref/models/querysets/">https://docs.djangoproject.com/en/dev/ref/models/querysets/</a>
                        </section>
                        <section>
                            <h2>Pobieranie pojedynczych obiektów</h2>
                            <p>Dobrze</p>
                            <pre><code data-trim contenteditable>
>>> print Post.objects.get(id=1)
Apple patc...
                            </code></pre>
                            <p>Źle</p>
                            <pre><code data-trim contenteditable>
>>> print Post.objects.filter(id=1)[0]
Apple patc...
                            </code></pre>
                            <p>Metody get() używamy tylko wyłącznie jeżeli oczekujemy jednego obiektu w bazie danych, w przeciwnym wypadku ORM zwróci wyjątek:</p>
                            <pre><code data-trim contenteditable>
>>> print Post.objects.get(title='Breaking News')
MultipleObjectsReturned: get() returned more than one Post - it returned 2!
                            </code></pre>
                        </section>
                        <section>
                            <h2>Queryset - Filtrowanie stringów</h2>
                            <pre><code data-trim contenteditable>
# Filtrowanie po treści pola:
>>> print Post.objects.filter(title='Google')
[< Post: Google ... >, < Post: Google... >]
# Zawartości słowa w polu:
>>> print Post.objects.filter(title__contains='Microsoft')
[< Post: MongoDB no...>, < Post: Microsoft ...>, < Post: MongoDB no...>]
# Pole zaczynające się na dany string:
>>> print Post.objects.filter(title__startswith='Microsoft')
[< Post: Microsoft ...>, < Post: Microsoft ...>]
# Pole zaczynające sie na dany string,
# case insensitive (bez uwzględniania wielkości liter, domyślnie na SQLite)
>>> print Post.objects.filter(title__startswith='microsoft')
[< Post: Microsoft ...>, < Post: Microsoft ...>]
                            </code></pre>
                        </section>
                        <section>
                            <h2>Queryset - Filtrowanie dat</h2>
                            <pre><code data-trim contenteditable>
# Zakres, range:
>>> import datetime
>>> end_date = datetime.date(2014, 6, 23)
>>> start_date = datetime.date(2014, 6, 1)
>>> print Post.objects.filter(created__range=(start_date, end_date))
[< Post: Don't use ...>]
# Year, month, day, czyli tez przedział ale prościej:
print Post.objects.filter(created__year=2014)
print Post.objects.filter(created__month=6)
print Post.objects.filter(created__day=1)
# Dzień tygodnia
print Post.objects.filter(created__week_day=2) #Poniedziałek
# Możemy łączyć skróty, np wszystkie czwartki maja:
print Post.objects.filter(created__month=5, created__year=2014,
      created__week_day=5)
                            </code></pre>
                        </section>
                        <section>
                            <h2>Queryset - filtrowanie zbiorem</h2>
                            <p>Pobieranie obiektów z listy ID'ków</p>
                            <p>Dobrze:</p>
                            <pre><code data-trim contenteditable>
# Jedno zapytanie do bazy.
>>> print Post.objects.filter(id__in=[1, 2, 3])
[< Post: Apple patc...>, < Post: Couchbase ...>, < Post: Avira Lice...>]
                            </code></pre>
                            Źle:
                            <pre><code data-trim contenteditable>
>>> ids = [1, 2, 3]
>>> for id in ids:
	post = Post.objects.get(id=id) # Trzy zapytania do bazy.
	print post
                            </code></pre>
                            <p>Możemy zastosować negacje:</p>
                            <pre><code data-trim contenteditable>
# Jedno zapytanie do bazy.
>>> print Post.objects.all().exclude(id__in=[1, 2, 3])
[< Post: Madrid's p...>, < Post: The Top Fi...>, < Post: Portable S...>,
                            </code></pre>
                        </section>
                        <section>
                            <h2>Queryset - Funkcje agregacyjne</h2>
                            <pre><code data-trim contenteditable>
# Importy
>>> from django.db.models import Avg, Max
# Zliczanie średniej
>>> Post.objects.all().aggregate(Avg('views'))
{'views__avg': 507.0}
# Max
>>> Post.objects.all().aggregate(Max('views'))
{'views__max': 996}
                            </code></pre>
                            <a href="https://docs.djangoproject.com/en/dev/topics/db/aggregation/">https://docs.djangoproject.com/en/dev/topics/db/aggregation/</a>
                        </section>
                        <section>
                            <h2>Zadanie</h2>
<ol>
    <li>Wróć do poprzedniej bazy danych.</li>
    <li>Włącz ponownie aplikacje subscription.</li>
    <li>Za pomocą django shella utwórz obiekt ze swoim adresem email (reszta danych dowolna), przypisz go do zmiennej aby poznać jego numer id.</li>
    <li>Pobierz obiekt po jego numerze id.</li>
    <li>Zmień mu pole accepted na True i zapisz obiekt.</li>
    <li>Napisz zapytanie które wyświetli wszystkie maile kończące się na domene Twojego adresu email. Posortuj je malejąco po id.</li>
    <li>Zlicz ilość obiektów z poprzedniego zapytania.</li>
    <li>Usuń obiekt utworzony w punkcie 3 z bazy danych.</li>
</ol>
                        </section>
                </section>
<!-- WIDOKI -->
                <section>
                    <section>
                        <h2>Widok i url</h2>
                    </section>
                    <section>
                        <h2>URL (ang. Uniform Resource Locator)</h2>
                        <p class="fragment">
                            Najczęściej kojarzony z adresem strony WWW.
                        </p>
                        <p class="fragment">
                            Jak wygląda adres URL?
                        </p>
                        <p>
                        <pre class="fragment"><code data-trim contenteditable>
http://www.domena_strony.com/post/URL...
|      |                    | 
|      |                    ścieżka dostępu
|      |                    do zasobu
|      host (adres serwera)
protokół
                        </code></pre>
                        </p>
                    </section>
                    <section>
                        <h2>
                            Przykładowy plik z url'ami
                        </h2>
                        <pre><code data-trim contenteditable>
from django.conf.urls import patterns, url

urlpatterns = patterns('',
    url(r'^articles/2003/$', 'news.views.special_case_2003'),
    url(r'^articles/(\d{4})/$', 'news.views.year_archive',
        name='year_archive'),
    url(r'^articles/(\d{4})/(\d{2})/$', 'news.views.month_archive',
        name='month_archive'),
    url(r'^articles/(\d{4})/(\d{2})/(\d+)/$', 'news.views.article_detail',
        name='article_detail'),
)
                        </code></pre>
                                                <p>Ważne</p>
                        <p>^ - oznacza początek tekstu, czyli części po domenie i porcie</p>
                        <p>$ - oznacza koniec tekstu</p>
                    </section>
                    <section>
                        <h2>
                            Przykładowy plik z include'm pozostałych url'i
                        </h2>
                        <pre><code data-trim contenteditable>
from django.conf.urls import include, patterns, url

urlpatterns = patterns('',
    url(r'^comments/', include('django.contrib.comments.urls')),
    url(r'^community/', include('django_website.aggregator.urls')),
    url(r'^contact/', include('django_website.contact.urls')),
)
                        </code></pre>

                    </section>
                    <section>
                        <h2>Widoki funkcyjne</h2>
                        <p>Każdy widok to funkcja w pliku views.py która przyjmuje jeden obowiązkowy parametr - request.</p>
                        <p>Powinien on zawsze zwracać obiekt HttpResponse, czyli odpowiedź która wyślemy spowrotem do przeglądarki</p>
                        <pre><code data-trim contenteditable>
from django.http import HttpResponse

def home(request):
    return HttpResponse('To jest <b>tekst</b>')
                        </code></pre>
                    </section>
                    <section>
                        <h2>Przypinamy url pod widok:</h2>
                        <pre><code data-trim contenteditable>
from post import views

urlpatterns = [
    url(r'^$', views.home, name='home'),
    url(r'^admin/', include(admin.site.urls)),
]                       </code></pre>

                    </section>
                    <section>
                        <h2>Widoki z parametrem liczbowym</h2>
                        <p>Za pomocą URL dispatcher możemy przypisywać parametry z URL'a do zmiennych</p>
                        views.py
                        <pre><code data-trim contenteditable>
def foo(request, id_):
    return HttpResponse('To jest id <b>{}</b>'.format(id_))
                        </code></pre>
                        urls.py
                        <pre><code data-trim contenteditable>
url(r'^foo/(?P&lt;id_&gt;\d+)/$', views.foo, name='foo'),
                        </code></pre>
                    </section>
                    <section>
                        <h2>Widoki z parametrem typu slug (string)</h2>
                                                views.py
                        <pre><code data-trim contenteditable>
def slug(request, slug):
    return HttpResponse('To jest slug <b>{}</b>'.format(slug))
                        </code></pre>
                        urls.py
                        <pre><code data-trim contenteditable>
url(r'^slug/(?P&lt;slug&gt;[\w-]+)$', views.slug, name='slug'),
                        </code></pre>
                    </section>
                    <section>
                        <h2>Jeden widok do dwóch adresów</h2>
                        <p>z parementrem i bez</p>
                        views.py
                        <pre><code data-trim contenteditable>
def slug(request, slug=None):
    return HttpResponse('To jest slug <b>{}</b>'.format(slug or 'Brak'))
                        </code></pre>
                        urls.py
                        <pre><code data-trim contenteditable>
url(r'^slug/(?P&lt;slug&gt;[\w-]+)$', views.slug, name='slug'),
url(r'^slug$', views.slug, name='empty_slug'),
                        </code></pre>
                        Więcej <a href="https://docs.djangoproject.com/en/1.8/topics/http/urls/">https://docs.djangoproject.com/en/1.8/topics/http/urls/</a>
                    </section>

                    <section>
                        <h2>Zwracanie Json</h2>
                        views.py
                        <pre><code data-trim contenteditable>
from django.http import JsonResponse
def json(request):
    return JsonResponse({'foo': 'bar'})
                        </code></pre>
                        urls.py
                        <pre><code data-trim contenteditable>
url(r'^json$', views.json, name='json'),
                        </code></pre>
                    </section>
                    <section>
                        <h2>Zmienne Django URL vs Zmienne GET?</h2>
                        <p>Zmienne django muszą być przekazane w takiej postaci i formacie jak są zdefiniowane w urls.py np: /foo/2</p>
                        <p>Zmienne GET nie są parsowane przez django, mogą być dodane dodatkowo ale nie muszą: /foo/2?a=3</p>
                        <p>Na przykładzie widoku z urlem 'foo' z poprzedniego przykładu liczba 2 typu int będzie dostępna pod zmienna id_, a liczba 3 typu str pod request.GET.get('a') </p>
                    </section>
                    <section>
                        <h2>Co kryje pod sobą request?</h2>
                        <li>Obiekt zalogowanego użytkownika (lub obiekt anonymous)</li>
                        <li>Obiekt aktualnej sesji</li>
                        <li>Nagłówek HTTP</li>
                        <li>Zmienne POST/GET</li>
                        <li>i wiele innych ...</li>
                    </section>

                    <section>
                        <h2>Sprawdźmy w praktyce</h2>
                        https://TWOJADRES.c9.io/?a=test
                        <pre><code data-trim contenteditable>
def home(request):
    return HttpResponse(
        """
        User: {} <br/>
        Wartosc zmiennej GET["a"]: {}<br/>
        HTTP USER AGENT: {}
        """.format(
            request.user,
            request.GET.get('a'),
            request.META['HTTP_USER_AGENT']
            ))
                        </code></pre>
                        Sposób na podejrzenie co jest w obiekcie:
                         <pre><code data-trim contenteditable>
import pdb; pdb.set_trace()
request.__dict__
                        </code></pre>
                    </section>
                    <section>
                        <h2>Widoki generyczne</h2>
                        <li>Bazują na klasach, a nie funkcjach</li>
                        <li>Pozwalają dziedziczyć lub wydzialać wspólne funkcjonalności</li>
                        <li>Wymagają minimalną ilość kodu</li>
                        <li>Wbudowane w django: CreateView, FormView, TemplateView, UpdateView, DeleteView, ListView, DetailView</li>
                    </section>
                    <section>
                        <h2>Przykład widoku generycznego</h2>
                         <pre><code data-trim contenteditable>
class OfferListView(ListView):
    model = Offer
    template_name = 'offer_list.html'
    paginate_by = 16
    custom_kwargs = {}
    search_url = reverse_lazy('search')
                        </code></pre>
                    </section>
                    <section>
                        <h2>Zadanie (widoki funkcyjne)</h2>
                        <li>Napisz widok i url który przyjmuje 2 parametry typu int i zwróci wynik ich dodawania</li>
                        <li>Napisz widok który nie przyjmuje żadnego parametru django i zwróci wynik dodawania zmiennych GET</li>
                        <li>Napisz widok który będzie prototypem widoku posta przyjaznym dla SEO czyli /post/opis-wpisu/2. Ma on zwracać zawsze taki sam tekst - "it works" dla jakichkolwiek zmian bloków 'opis-wpisu' oraz '2' </li>
                    </section>
                </section>

<!-- TEMPLATE -->
                <section>
                    <section>
                        <h2>Szablony (ang. Template)</h2>
                    </section>
                    <section>
                        <h2>Szablony HTML</h2>
                        <p>czyli system łączenia logiki z warstwą prezentacji</p>
                        <pre><code data-trim contenteditable>
from django.shortcuts import render_to_response

def home(request):
    return render_to_response('home.html', {'foo': 'bar'})
                        </code></pre>
                        W pliku settings.py
<pre><code data-trim contenteditable>
                        TEMPLATES = [
    {
....
        'DIRS': ['templates'],
....
</code></pre>
Tworzymy w katalogu głównym 'blog' katalog 'templates', a nim plik 'home.html'
                    </section>
                    <section>
                        <h2>Context</h2>
                        <p>To wszystko to co chcemy przekazać z widoku do templatki, czyli np. obiekty z bazy danych lub inne dane które zostały wygenerowane dynamicznie</p>
                    </section>
                    <section>
                        <h2>Wyświetlanie zmiennej</h2>
                        <pre><code data-trim contenteditable>
{{ foo }}
                        </code></pre>
                    </section>
<section>
                        <h2>Wyświetlanie danych ze słownika</h2>
<pre><code data-trim contenteditable>
def home(request):
    blah = {'foo': 'bar'}
    return render_to_response('home.html', {'blah': blah})
</code></pre>

<pre><code data-trim contenteditable>
{{ blah.foo }}
</code></pre>
                    </section>
                    <section>

                    <h2>Wyświetlanie danych z listy</h2>
<pre><code data-trim contenteditable>
def home(request):
    blah = ['foo', 'bar']
    return render_to_response('home.html', {'blah': blah})
</code></pre>

<pre><code data-trim contenteditable>
{{ blah.0 }}<br/>
{{ blah.1 }}
</code></pre>

                    </section>
                    <section>
                        <h2>Wyświetlanie danych z obiektu</h2>
<pre><code data-trim contenteditable>
from models import Post

def home(request):
    post = Post.objects.get(pk=1)
    return render_to_response('home.html', {'post': post})
</code></pre>

<pre><code data-trim contenteditable>
{{ post.title }}
</code></pre>
                    </section>
                    <section>
                        <h2>Tworzenie pętli</h2>
<pre><code data-trim contenteditable>
def home(request):
    list_ = ['foo', 'bar', 'blah']
    return render_to_response('home.html', {'list_': list_})
</code></pre>

<pre><code data-trim contenteditable>
{% for item in list_ %}
    - {{ item }}</br>
{% endfor %}
</code></pre>
                    </section>
                    <section>
                        <h2>Tworzenie pętli 2</h2>
                        <p>Przykład na słowniku</p>
<pre><code data-trim contenteditable>
def home(request):
    dict_ = {
        '1': 'foo',
        '2': 'bar',
    }
    return render_to_response('home.html', {'dict_': dict_})
</code></pre>

<pre><code data-trim contenteditable>
{% for pk, value in dict_.iteritems %}
    {{ pk }} - {{ value }}
{% endfor %}
</code></pre>
                    </section>
<section>
                        <h2>extends</h2>
                        <p>
                            Stosujemy w przypadku, gdy chcemy rozszerzyć jeden szablon poprzez drugi
                            <pre><code data-trim contenteditable>
"base.html"
&uArr;  &uArr;  &uArr;  &uArr;  &uArr;  &uArr;
"my_own_view.html"
                            </code></pre>
                        </p>
                    </section>
                    <section>
                        <h2>Struktura</h2>
                        <p>
                            Przykładowy plik bazowy 'base.html'
                            <pre><code data-trim contenteditable>
<!DOCTYPE html>
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;{% block title %}{% endblock %}&lt;/title&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;style&gt;
    {% block style %}{% endblock %}
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    {% block content %}{% endblock %}
  &lt;/body&gt;
&lt;/html&gt;
                            </code></pre>
                        </p>
                    </section>
                    <section>
                        <h2>Plik 'home.html' z plikiem 'base.html'</h2>
                        <p>
                            <pre><code data-trim contenteditable>
{% extends "base.html" %}

{% block title %}Title{% endblock %}

{% block content %}
<h1>Title</h1>

{% for item in list_ %}
    {{ item }}
{% endfor %}
{% endblock %}
                            </code></pre>
                        </p>
                    </section>
                    <section>
                        <h2>include</h2>
                        <p>
                            Stosujemy w przypadku, gdy w jednym szablonie, chcemy wczytać inny szablon. Przykładowe zastosowanie to blok menu z informacjami o aktywnym module.
                        <pre><code data-trim contenteditable>
{% include menu.html %}
                        </code></pre>
                        W której mamy np.:
                        <pre><code data-trim contenteditable>
&lt;a href="{&#37; url 'home' &#37;}"
&#123;&#37; if active == 'home' &#37;}style="background: yellow"{&#37; endif &#37;}>
Home&lt;/a>
                        </code></pre>
                        Można też przekazać parametry
                        <pre><code data-trim contenteditable>
{% include "menu.html" with active="home" %}
                        </code></pre>
                        </p>
                    </section>
                     <section>
                        <h2>Warunki</h2>
                        <p>
                            Templatetag warunkowy
                            <pre><code data-trim contenteditable>
{% if condition %}
    case 1
{% else %}
    case 2
{% endif %}
                            </code></pre>
                        </p>
                    </section>
                     <section>
                        <h2>Linki</h2>
                            <p>Tworzenie odsyłaczy bazując na urls.py</p>
                            <pre><code data-trim contenteditable>
<a href="{% url 'name' %}">Home</a>
                            </code></pre>
                            <p>Z parametrem:</p>
                            <pre><code data-trim contenteditable>
<a href="{% url 'foo' 1 %}">Foo</a>
                            </code></pre>

                    </section>
                    <section>
                        <h2>Filtry</h2>
                        <p>
                            Filtry są używane na obiekcie, który ma być wyrenderowany, używany w {{ }} oraz za |.
                            Występują także filtry, którym można podać parametr, który jest opcjonalny przy filtrach.
                        </p>
                    </section>
                    <section>
                        <h2>Przykłady:</h2>
                        <p>
                            Obcinanie znaków = "Joel is a slug" => "Joel i..."
                            <pre><code data-trim contenteditable>
{{ value|truncatechars:9 }}
                            </code></pre>
                        </p>
                        Obcinanie wyrazów = "Joel is a slug" => "Joel is ..."
                        <p>
                            <pre><code data-trim contenteditable>
{{ value|truncatewords:2 }}
                            </code></pre>
                        </p>
                        YesNo filtr (zamiast if)
                        <p>
                            <pre><code data-trim contenteditable>
{{ value|yesno:"yeah,no,maybe" }}
                            </code></pre>
                        </p>
                        Tworzenie tytułu = "my FIRST post" => "My First Post"
                        <p>
                            <pre><code data-trim contenteditable>
{{ value|title }}
                            </code></pre>
                        </p>
                    </section>
                    <section>
                        <h2>Date</h2>
                        <p>
                            Daty są bardzo często wykorzystywane. Do wyświetlania, formatowania dat, aby były wyświetlone tak jak chcemy używany filtra date.
                            Filtr date przyjmuje parametry podobne do funkcji PHP'owej date().<br/>
                        </p>
                    </section>
                    <section>
                        <p>
Parsowanie daty z podaniem w jaki sposób:
                            <pre><code data-trim contenteditable>
{{ value|date:"D d M Y" }}
                            </code></pre>
                        </p>
                        <p>
Przy ustawionym USE_L10N na True:
                            <pre><code data-trim contenteditable>
{{ value|date:"SHORT_DATE_FORMAT" }}
                            </code></pre>
                        </p>
                        <p>
Bez dodania parametrów, django użyje DATE_FORMAT z settings.py
                            <pre><code data-trim contenteditable>
{{ value|date }}
                            </code></pre>
                        </p>
                    </section>
                    <section>
                        <h2>Static</h2>
                        <p>
                            <pre><code data-trim contenteditable>
{% load static %}
{% static "images/hi.jpg" as myphoto %}
<img src="{{ myphoto }}"></img>
                            </code></pre>
                        </p>
                        <p>
                            Więcej na temat templatetag'ów i filtrów można znaleźć w dokumentacji.
<a href="https://docs.djangoproject.com/en/1.6/ref/templates/builtins/#std:templatetag-include">
https://docs.djangoproject.com/en/1.6/ref/templates/builtins/...</a>
                        </p>
                    </section>
                    <section>
                        <h2>safe</h2>
                        <p>Domyślnie django nie pozwoli nam na wyświetlenie kodu HTML który zostanie zwrócony z widoków. Dzieje się to ze względów bezpieczeństwa.
                            Aby wyświetlić HTML musimy zrobić to świadomie przy użyciu filtra safe</p>
                            <pre><code data-trim contenteditable>
{{ some_html_content|safe }}
                            </code></pre>
                    </section>
                    <section>
                        <h2>Zadanie</h2>
<li>Stwórz nową aplikacje pt. news.</li>
<li>Zarejestruj ja w settings.py.</li>
<li>Stwórz trzy widoki: "News" - lista newsów, strona z pojedynczym wpisem oraz strona "o mnie"</li>
<li>Newsy powinny być zaczytane ze słownika: <a href="https://gist.githubusercontent.com/tomaszwozniak/1bfd5cb95d2374c9b783/raw/9f7252ccd10bb25b6f72660af6ec94799d6e390a/gistfile1.txt">Django news</a></li>
<li>Każdy news powinien być przycięty do 10 wyrazów oraz posiadać link "więcej" który będzie kierował do strony z pojedynczym wpisem</li>
<li>Wszystkie widoki powinny mieć jedną templatkę bazową</li>
<li>Wszystkie widoki powinny mieć wspólne menu. Użyj do tego {% include %}</li>
                    </section> <section>
                        <h2>Zadanie cd..</h2>
<li>W menu powinny być dwie pozycje: "News" oraz "O mnie"</li>
<li>W menu linki powinny mieć oznaczenie aktywnej strony (dowolnie np. przez css)</li>
<li>Strona "o mnie" powinna wyświetlać dowolny tekst przekazany z widoku</li>
<li>W templatce bazowej wyświetl "Dziś jest x" gdzie x to dzisiejsza data w formacie 'd M Y'</li>
                    </section>
                </section>

				<section>
                    <section>
					<h2>Formularze</h2>
                    </section>
                    <section>
						<h2>Po co nam automatyczne formularze?</h2>
						<li>automatyczna walidacja</li>
                        <li>spójność danych</li>
                        <li>automatyczne parsowanie typów danych</li>
                        <li>oszczędzają czas</li>
                        <li>wysoka możliwość customizacji</li>
                        <li>własne widgety</li>
                        <li>mniejsza możliwość pomyłki</li>
                        <li>pisanie ręcznie formularzy jest nudne</li>
					</section>
                    <section>
					<h2>ModelForm</h2>
                    w katalogu post tworzymy plik forms.py
                            <pre><code data-trim contenteditable>
from django import forms

from post.models import Post


class PostForm(forms.ModelForm):
    class Meta:
        model = Post
        exclude = ('views',)
        # fields = (...)
                            </code></pre>
                   Generowanie formularza można sprawdzić w shellu (python manage.py shell)
                            <pre><code data-trim contenteditable>
Python 2.7.5+ (default, Feb 27 2014, 19:37:08)
[GCC 4.8.1] on linux2
Type "help", "copyright", "credits" or "license" for more information.
(InteractiveConsole)
>>> from post.forms import PostForm
>>> form = PostForm()
>>> print form
                            </code></pre>
					</section>
                    <section>
					<h2>Spróbujmy w praktyce</h2>
						<p>Co będzie nam potrzebne?</p>
                        <li>Formularz</li>
						<li>Adres URL</li>
                        <li>Widok CreateView</li>
                        <li>Template</li>
					</section>
                    <section>
					<h2>Widok</h2>
						<p>W aplikacji post, plik views.py:</p>
						<pre><code data-trim contenteditable>
from django.shortcuts import render
from django.views.generic.edit import CreateView

from post.forms import PostForm
from post.models import Post


class PostCreateView(CreateView):
    model = Post
    form_class = PostForm
    success_url = '/post/add'
    template_name = 'post/add.html'
                        </code></pre>
					</section>
                    <section>
					<h2>URL</h2>
						<p>W głównym pliku urls dodajemy:</p>
						<pre><code data-trim contenteditable>
url(r'^post/', include('post.urls')),
                        </code></pre>
                        <p>W aplikacji post, w pliku urls.py:</p>
                        <pre><code data-trim contenteditable>
from django.conf.urls import patterns, url

from post import views

urlpatterns = patterns(
    '',
    url(r'^add/$', views.PostCreateView.as_view(), name='add_post'),
)
                        </code></pre>
					</section>
                    <section>
					<h2>Template</h2>
						<p>Sprawdzamy czy mamy w settings.py odpowiedni loader</p>
						<pre><code data-trim contenteditable>
TEMPLATE_LOADERS = (
    'django.template.loaders.app_directories.Loader',
)
                        </code></pre>
                        <p>Tworzymy strukture katalogów oraz plik z templatką post/templates/post/add.html</p>
                        <p>Umieszczamy w nim nasz formularz:</p>
                        <pre><code data-trim contenteditable>
<form method="post">
    {% csrf_token %}
    {{ form }}
    <input type="submit" />
</form>
                        </code></pre>
					</section>
                    <section>
					<h2>Nikt nie lubi brzydkich formularzy</h2>
						<p>Instalujemy django-bootstrap3 (aktualizujemy requriements.pip)</p>
						<pre><code data-trim contenteditable>
pip install django-bootstrap3
                        </code></pre>
                        <p>Dodajemy 'bootstrap3' do INSTALLED_APPS</p>
                        <p>Modyfikujemy formularz <a href="https://gist.githubusercontent.com/tomaszwozniak/9ff47aa4152c78b4ca57/raw/cec97ef4d5b1929c43a9177589b43d2c4189d759/gistfile1.txt">add.html</a></p>
                        <p>Tworzymy plik: <a href="https://raw.githubusercontent.com/tomaszwozniak/studies/master/post/templates/post/base.html">base.html</a>:</p>
					</section>
                    <section>
					<h2>Widok listy</h2>
						<pre><code data-trim contenteditable>
# w pliku post/views.py
from django.views.generic.list import ListView

class PostListView(ListView):
    model = Post
    template_name = 'post/list.html'
                        </code></pre>
                        <pre><code data-trim contenteditable>
# w pliku post/urls.py
url(r'^$', views.PostListView.as_view(), name='posts'),
                        </code></pre>
                        <p>Pobieramy <a href="https://gist.githubusercontent.com/tomaszwozniak/47d78bde24be76eb5546/raw/01bb387f2cabacc6cab4b723f64b60af3c31acfe/gistfile1.txt">list.html</a></p>
						<pre><code data-trim contenteditable>
# w pliku post/views.py modyfikujemy CreateView o nowy success_url
from django.core.urlresolvers import reverse

class PostCreateView(CreateView):
    model = Post
    form_class = PostForm
    template_name = 'post/add.html'

    @property
    def success_url(self):
        return reverse('posts')
                        </code></pre>

                    </section>
                    <section>
					<h2>Edycja</h2>
						<pre><code data-trim contenteditable>
# w pliku post/views.py
from django.views.generic.edit import CreateView, UpdateView

class PostEditView(UpdateView):
    model = Post
    form_class = PostForm
    template_name = 'post/add.html'

    @property
    def success_url(self):
        return reverse('posts')
                        </code></pre>
                        <pre><code data-trim contenteditable>
# w pliku post/urls.py
url(r'^edit/(?P&lt;pk&gt;\d+)/$', views.PostEditView.as_view(), name='edit_post'),
                        </code></pre>
						<pre><code data-trim contenteditable>
{# w pliku post/templates/post/list.html (dodajemy link do edycji) #}
<h2>
    #{{ post.id }} - {{ post.title }}
    <a href="{% url 'edit_post' post.id %}">[E]</a>
</h2>
                        </code></pre>

                    </section>
                    <section>
					<h2>Dodawanie komentarzy</h2>
                        <p>Widok:</p>
						<pre><code data-trim contenteditable>
from post.models import Post, Comment
from post.forms import PostForm, CommentForm

class CommentCreateView(CreateView):
    model = Comment
    form_class = CommentForm
    template_name = 'post/add.html'

    @property
    def success_url(self):
        return reverse('posts')
                        </code></pre>
                        <p>Dodajemy URL:</p>
                        <pre><code data-trim contenteditable>
url(r'^add/comment/(?P&lt;post_pk&gt;\d+)/$', views.CommentCreateView.as_view(), name='add_comment'),
                        </code></pre>
                    </section>
                    <section>
					<h2>Ustawianie domyslnych wartości</h2>
                        <pre><code data-trim contenteditable>
class CommentCreateView(CreateView):
    model = Comment
    form_class = CommentForm
    template_name = 'post/form.html'

    @property
    def success_url(self):
        return reverse('posts')

    def get_form_kwargs(self):
        form_kwargs = super(CommentCreateView, self).get_form_kwargs()
        post = Post.objects.get(pk=self.kwargs['post_pk'])
        instance = Comment(post=post)
        form_kwargs['instance'] = instance
        return form_kwargs
                        </code></pre>
                    </section>
                    <section>
					<h2>Ukrywanie niepotrzebnego pola</h2>
                        <pre><code data-trim contenteditable>
class CommentForm(forms.ModelForm):
    class Meta:
        model = Comment
        exclude = ('post', )
                        </code></pre>
                    </section>
                    <section>
					<h2>Rozwijamy model o dodatkowe pola</h2>
                        <pre><code data-trim contenteditable>
@property
def number_of_comments(self):
    return self.comment_set.all().count()
                        </code></pre>
                        <p>Modyfikacja templatki</p>
                        <pre><code data-trim contenteditable>
<p>
    <a href="{% url 'add_comment' post.id %}">
        Comments ({{ post.number_of_comments }})
    </a>
</p>
                        </code></pre>
                    </section>
                    <section>
					<h2>Wyświetlamy post razem z komentarzami</h2>
                        <p></p>
                        <pre><code data-trim contenteditable>
# w pliku post/views.py modyfikacja contextu z
# formularzem (klasa CommentCreateView)
def get_context_data(self, **kwargs):
    context = super(CommentCreateView, self).get_context_data(**kwargs)
    context['post'] = Post.objects.get(pk=self.kwargs['post_pk'])
    context['comments'] = Comment.objects.filter(
        post=context['post'])

    return context
                        </code></pre>
                        <pre><code data-trim contenteditable>
{# Modyfikacja post/templates/post/comment_form.html #}
<h2>#{{ post.id }} - {{ post.title }}</h2>
{{ post.content }}
<p>
    <a href="{% url 'add_comment' post.id %}">
        Comments ({{ post.number_of_comments }})
    </a>
</p>
{% for comment in comments %}<p>{{ comment }}</p>{% endfor %}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Własna walidacja</h2>
                        <p>W klasie CommentForm (forms.py)</p>
                        <pre><code data-trim contenteditable>
def clean_full_name(self):
    full_name = self.cleaned_data['full_name']
    if "donald" in full_name.lower():
        raise forms.ValidationError("You cannot comment on this blog!")

    # Always return the cleaned data, whether you have changed it or
    # not.
    return full_name
                        </code></pre>
                    </section>
                    <section>
                        <h2>Zadanie</h2>
<ol>
    <li>W głównym szablonie listy postów dodaj link 'Nowy post'. Skorzystaj z taga {% url %}.</li>
    <li>W tym samym szablonie wyświetl w nagłówku posta datę utworzenia.</li>
    <li>Ustaw format daty na "D d M Y" (przykład: Tue 01 Jul 2014).</li>
    <li>Dodaj link 'powrót do listy postów' w szablonie dodawania komentarza oraz w szablonie dodawania posta. Skorzystaj z taga {% url %}.</li>
    <li>W widoku dodawania komentarza zmień success_url na ten w którym się znajdujesz (zamiast do listy postów).</li>
    <p>- stwórz metodę get_success_url(self) w widoku</p>
    <p>- zwróć poprawny url za pomocą funkcji reverse i id posta pobranego z self.kwargs</p>
</ol>
                    </section>
                    <section>
                        <h2>Zadanie dla chętnych</h2>
<ol>
    <li>Napisz validator który zabroni użycia słowa "polityka" w komentarzu.</li>
    <li>Zmień url z /post/ na /.</li>
</ol>
                    </section>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
